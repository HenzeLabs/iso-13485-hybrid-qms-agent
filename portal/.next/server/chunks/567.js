exports.id=567,exports.ids=[567],exports.modules={34741:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2583,23)),Promise.resolve().then(s.t.bind(s,26840,23)),Promise.resolve().then(s.t.bind(s,38771,23)),Promise.resolve().then(s.t.bind(s,13225,23)),Promise.resolve().then(s.t.bind(s,9295,23)),Promise.resolve().then(s.t.bind(s,43982,23))},4625:()=>{},7769:(e,t,s)=>{"use strict";s.d(t,{Z:()=>P});var a=s(95344),n=s(3729),r=s(20783),i=s.n(r),o=s(22254),c=s(47674),l=s(2273),d=s(45961),m=s(37121),u=s(14513),g=s(18822),p=s(48120),x=s(98200),f=s(38852),h=s(11453),y=s(30617),v=s(7060),w=s(73229),b=s(42739),_=s(36135),j=s(53460),N=s(96548);let C=new j.ZP({apiKey:process.env.OPENAI_API_KEY||"",dangerouslyAllowBrowser:!0});class S{async sendMessage(e,t,s){let a={id:Date.now().toString(),role:"user",content:e,timestamp:new Date().toISOString()};this.conversation.messages.push(a);try{let e=(await N.wN.getFunctions()).functions||[],a=await C.chat.completions.create({model:"gpt-4-turbo-preview",messages:[{role:"system",content:this.getSystemPrompt()},...this.conversation.messages.map(e=>({role:e.role,content:e.content}))],functions:e.map(e=>({name:e.name,description:e.description,parameters:e.parameters})),function_call:"auto",temperature:.1}),n=a.choices[0]?.message;if(!n)throw Error("No response from OpenAI");if(n.function_call)return await this.handleFunctionCall(n,t,s);let r={id:Date.now().toString(),role:"assistant",content:n.content||"I apologize, but I couldn't generate a response.",timestamp:new Date().toISOString()};return this.conversation.messages.push(r),r}catch(t){console.error("LLM Assistant error:",t);let e={id:Date.now().toString(),role:"assistant",content:"I encountered an error processing your request. Please try again.",timestamp:new Date().toISOString()};return this.conversation.messages.push(e),e}}async handleFunctionCall(e,t,s){let a=e.function_call,n=a.name,r={function_name:n,arguments:JSON.parse(a.arguments||"{}"),user_id:t,confirmed:!1,session_id:s},i=await N.wN.executeFunction(r);if(i.confirmation_required){let e={id:Date.now().toString(),function_call:r,message:i.confirmation_message||"Confirm this action?",timestamp:new Date().toISOString()};this.conversation.pending_confirmations.push(e);let t={id:Date.now().toString(),role:"assistant",content:`I'd like to ${n.replace("_"," ")} for you. ${i.confirmation_message}

Would you like me to proceed?`,timestamp:new Date().toISOString(),function_calls:[r],citations:i?.citations};return this.conversation.messages.push(t),t}let o={id:Date.now().toString(),role:"assistant",content:this.formatFunctionResult(n,i),timestamp:new Date().toISOString(),function_calls:[r],citations:i?.citations};return this.conversation.messages.push(o),o}async confirmPendingAction(e,t,s,a){let n=this.conversation.pending_confirmations.find(t=>t.id===e);if(!n)throw Error("Confirmation not found");if(this.conversation.pending_confirmations=this.conversation.pending_confirmations.filter(t=>t.id!==e),!t){let e={id:Date.now().toString(),role:"assistant",content:"Action cancelled. Is there anything else I can help you with?",timestamp:new Date().toISOString()};return this.conversation.messages.push(e),e}let r={...n.function_call,confirmed:!0,session_id:a},i=await N.wN.executeFunction(r),o={id:Date.now().toString(),role:"assistant",content:i.success?this.formatFunctionResult(n.function_call.function_name,i):`Failed to execute action: ${i.error}`,timestamp:new Date().toISOString(),function_calls:[r],citations:i?.citations};return this.conversation.messages.push(o),o}formatFunctionResult(e,t){if(!t.success)return`I encountered an error: ${t.error}`;switch(e){case"create_capa":return`âœ… CAPA created successfully: **${t.result.capa_id}**

The CAPA has been created and is now available in the CAPA Manager. You can add root cause analysis, assign actions, and route for approvals.`;case"create_dcr":return`âœ… DCR created successfully: **${t.result.dcr_id}**

The Document Change Request has been created and is now available in the DCR Manager. You can add supporting documents and route for approvals.`;case"update_capa_analysis":return`âœ… CAPA analysis updated for **${t.result.capa_id}**

The root cause analysis and corrective/preventive actions have been documented.`;case"get_capa_status":case"get_dcr_status":let s=t.result;return`ðŸ“‹ **Status:** ${s.status}
**Last Updated:** ${new Date(s.updated_at).toLocaleDateString()}

${s.issue_description||s.description}`;default:return`âœ… Action completed successfully. ${JSON.stringify(t.result)}`}}getSystemPrompt(){return`You are a Quality Management System (QMS) assistant for an ISO 13485 compliant medical device company. You help users manage CAPA (Corrective and Preventive Actions) and DCR (Document Change Requests) workflows.

Key capabilities:
- Create and manage CAPA cases for quality issues
- Create and manage DCR requests for document changes
- Retrieve status information for existing CAPAs and DCRs
- Provide guidance on ISO 13485 compliance requirements

Important guidelines:
- Always ask for confirmation before creating or modifying records
- Provide clear, professional responses focused on quality management
- Include relevant CAPA/DCR IDs in responses when available
- Suggest next steps in workflows (e.g., "Next, you may want to add corrective actions")
- Be concise but thorough in explanations

When users ask about creating CAPAs or DCRs, gather the required information:
- For CAPAs: department, issue description, severity
- For DCRs: department, change type, reason, description, affected process

Always maintain a professional, helpful tone focused on quality and compliance.`}getConversation(){return this.conversation}setConversation(e){this.conversation=e}clearConversation(){this.conversation={messages:[],pending_confirmations:[]}}constructor(){this.conversation={messages:[],pending_confirmations:[]}}}class A{async saveState(e){}async loadState(e){return null}async addPendingAction(e,t){let s=await this.loadState(e)||{sessionId:e,userId:t.functionCall?.arguments?.userId||"unknown",context:{},pendingActions:[],citations:[],messages:[]};s.pendingActions.push(t),await this.saveState(s)}}function D({userId:e}){let[t]=(0,n.useState)(()=>new S),s=(0,n.useMemo)(()=>new A,[]),[r,i]=(0,n.useState)([]),[o,c]=(0,n.useState)([]),[l,d]=(0,n.useState)([]),[u,p]=(0,n.useState)(""),[x,f]=(0,n.useState)(!1),[j,N]=(0,n.useState)(""),C=(0,n.useRef)(null),D=()=>{C.current?.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{D()},[r]),(0,n.useEffect)(()=>{N("undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():`session-${Date.now()}`)},[]),(0,n.useEffect)(()=>{(async()=>{if(!j)return;let e=await s.loadState(j);e&&(t.setConversation({messages:e.messages,pending_confirmations:e.pendingActions.map(t=>({id:t.id,function_call:{function_name:t.functionCall.name,arguments:t.functionCall.arguments,user_id:e.userId,confirmed:!1,session_id:e.sessionId},message:t.message,timestamp:t.createdAt}))}),i(e.messages),c(e.pendingActions.map(t=>({id:t.id,function_call:{function_name:t.functionCall.name,arguments:t.functionCall.arguments,user_id:e.userId,confirmed:!1,session_id:e.sessionId},message:t.message,timestamp:t.createdAt}))),d(e.citations||[]))})()},[t,s,j]);let I=async()=>{if(!j)return;let a=t.getConversation(),n=a.pending_confirmations.map(e=>({id:e.id,functionCall:{name:e.function_call.function_name,arguments:e.function_call.arguments},message:e.message,createdAt:e.timestamp})),r=[...l,...a.messages.flatMap(e=>e.citations||[])],i={sessionId:j,userId:e,context:{lastInteraction:new Date().toISOString()},pendingActions:n,citations:r,messages:a.messages};await s.saveState(i),d(r)},P=async()=>{if(!u.trim()||x)return;let s=u.trim();p(""),f(!0);try{await t.sendMessage(s,e,j);let a=t.getConversation();i([...a.messages]),c([...a.pending_confirmations]);let n=a.messages.flatMap(e=>e.citations||[]);n.length&&d(e=>[...e,...n]),await I()}catch(e){console.error("Error sending message:",e)}finally{f(!1)}},k=async(s,a)=>{f(!0);try{await t.confirmPendingAction(s,a,e,j);let n=t.getConversation();i([...n.messages]),c([...n.pending_confirmations]);let r=n.messages.flatMap(e=>e.citations||[]);r.length&&d(e=>[...e,...r]),await I()}catch(e){console.error("Error handling confirmation:",e)}finally{f(!1)}};return(0,a.jsxs)("div",{className:"flex h-full flex-col",children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===r.length&&(0,a.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[a.jsx(y.Z,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),a.jsx("p",{className:"text-lg font-medium",children:"QMS Assistant"}),a.jsx("p",{className:"text-sm",children:"Ask me about CAPAs, DCRs, or quality management processes."})]}),r.map(e=>a.jsx("div",{className:`flex ${"user"===e.role?"justify-end":"justify-start"}`,children:(0,a.jsxs)("div",{className:`flex max-w-[80%] ${"user"===e.role?"flex-row-reverse":"flex-row"}`,children:[a.jsx("div",{className:`flex-shrink-0 ${"user"===e.role?"ml-2":"mr-2"}`,children:"user"===e.role?a.jsx(g.Z,{className:"h-6 w-6 text-gray-600"}):a.jsx(y.Z,{className:"h-6 w-6 text-primary-600"})}),(0,a.jsxs)("div",{className:`rounded-lg px-3 py-2 ${"user"===e.role?"bg-primary-600 text-white":"bg-gray-100 text-gray-900"}`,children:[a.jsx("div",{className:"whitespace-pre-wrap text-sm",children:e.content}),a.jsx("div",{className:`text-xs mt-1 ${"user"===e.role?"text-primary-100":"text-gray-500"}`,children:(0,h.o0)(e.timestamp)})]})]})},e.id)),o.map(e=>a.jsx("div",{className:"bg-warning-50 border border-warning-200 rounded-lg p-4",children:a.jsx("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("h4",{className:"text-sm font-medium text-warning-800 mb-2",children:"Confirmation Required"}),a.jsx("p",{className:"text-sm text-warning-700 mb-3",children:e.message}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>k(e.id,!0),disabled:x,className:"btn btn-success btn-sm flex items-center gap-1",children:[a.jsx(v.Z,{className:"h-3 w-3"}),"Confirm"]}),(0,a.jsxs)("button",{onClick:()=>k(e.id,!1),disabled:x,className:"btn btn-secondary btn-sm flex items-center gap-1",children:[a.jsx(w.Z,{className:"h-3 w-3"}),"Cancel"]})]})]})})},e.id)),x&&a.jsx("div",{className:"flex justify-start",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-lg px-3 py-2",children:[a.jsx(b.Z,{className:"h-4 w-4 animate-spin text-primary-600"}),a.jsx("span",{className:"text-sm text-gray-600",children:"Assistant is thinking..."})]})}),l.length>0&&(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-2 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700",children:[a.jsx(m.Z,{className:"h-4 w-4"}),"Supporting documents"]}),a.jsx("div",{className:"space-y-2",children:l.map((e,t)=>(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:[a.jsx("a",{href:e.url,target:"_blank",rel:"noreferrer",className:"font-medium text-primary-700 hover:text-primary-900",children:e.title}),a.jsx("div",{className:"text-xs text-gray-500",children:e.snippet})]},`${e.url}-${t}`))})]}),a.jsx("div",{ref:C})]}),(0,a.jsxs)("div",{className:"border-t border-gray-200 p-4",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[a.jsx("textarea",{value:u,onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),P())},placeholder:"Ask about CAPAs, DCRs, or quality processes...",className:"flex-1 resize-none border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:2,disabled:x}),a.jsx("button",{onClick:P,disabled:!u.trim()||x,className:"btn btn-primary px-3 py-2 disabled:opacity-50",children:a.jsx(_.Z,{className:"h-4 w-4"})})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Press Enter to send, Shift+Enter for new line"})]})]})}let I=[{name:"Dashboard",href:"/",icon:l.Z},{name:"CAPA Manager",href:"/capa",icon:d.Z},{name:"DCR Manager",href:"/dcr",icon:m.Z}];function P({children:e}){let[t,s]=(0,n.useState)(!1),[r,l]=(0,n.useState)(!1),d=(0,o.usePathname)(),{data:m}=(0,c.useSession)(),y=async()=>{await (0,c.signOut)({callbackUrl:"/auth/signin"})};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsxs)("div",{className:(0,h.cn)("fixed inset-0 z-50 lg:hidden",t?"block":"hidden"),children:[a.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>s(!1)}),(0,a.jsxs)("div",{className:"fixed inset-y-0 left-0 flex w-64 flex-col bg-white",children:[(0,a.jsxs)("div",{className:"flex h-16 items-center justify-between px-4",children:[a.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"QMS Portal"}),a.jsx("button",{onClick:()=>s(!1),children:a.jsx(u.Z,{className:"h-6 w-6"})})]}),a.jsx("nav",{className:"flex-1 space-y-1 px-2 py-4",children:I.map(e=>{let t=d===e.href;return(0,a.jsxs)(i(),{href:e.href,className:(0,h.cn)("group flex items-center px-2 py-2 text-sm font-medium rounded-md",t?"bg-primary-100 text-primary-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),onClick:()=>s(!1),children:[a.jsx(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})})]})]}),a.jsx("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-64 lg:flex-col",children:(0,a.jsxs)("div",{className:"flex flex-col flex-grow bg-white border-r border-gray-200",children:[a.jsx("div",{className:"flex h-16 items-center px-4",children:a.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"QMS Portal"})}),a.jsx("nav",{className:"flex-1 space-y-1 px-2 py-4",children:I.map(e=>{let t=d===e.href;return(0,a.jsxs)(i(),{href:e.href,className:(0,h.cn)("group flex items-center px-2 py-2 text-sm font-medium rounded-md",t?"bg-primary-100 text-primary-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[a.jsx(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,a.jsxs)("div",{className:"border-t border-gray-200 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(g.Z,{className:"h-8 w-8 text-gray-400"}),(0,a.jsxs)("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm font-medium text-gray-700",children:m?.user?.name||"Demo User"}),a.jsx("p",{className:"text-xs text-gray-500",children:"QA Manager"})]})]}),(0,a.jsxs)("button",{onClick:y,className:"mt-3 flex items-center text-sm text-gray-500 hover:text-gray-700",children:[a.jsx(p.Z,{className:"mr-2 h-4 w-4"}),"Sign out"]})]})]})}),(0,a.jsxs)("div",{className:"lg:pl-64",children:[(0,a.jsxs)("div",{className:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8",children:[a.jsx("button",{type:"button",className:"-m-2.5 p-2.5 text-gray-700 lg:hidden",onClick:()=>s(!0),children:a.jsx(x.Z,{className:"h-6 w-6"})}),(0,a.jsxs)("div",{className:"flex flex-1 gap-x-4 self-stretch lg:gap-x-6",children:[a.jsx("div",{className:"flex flex-1"}),a.jsx("div",{className:"flex items-center gap-x-4 lg:gap-x-6",children:(0,a.jsxs)("button",{type:"button",className:"flex items-center gap-2 rounded-md bg-primary-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-500",onClick:()=>l(!r),children:[a.jsx(f.Z,{className:"h-4 w-4"}),"AI Assistant"]})})]})]}),a.jsx("main",{className:"py-10",children:a.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:e})})]}),a.jsx("div",{className:(0,h.cn)("fixed inset-y-0 right-0 z-50 w-96 bg-white shadow-xl transform transition-transform duration-300 ease-in-out",r?"translate-x-0":"translate-x-full"),children:(0,a.jsxs)("div",{className:"flex h-full flex-col",children:[(0,a.jsxs)("div",{className:"flex h-16 items-center justify-between border-b border-gray-200 px-4",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"AI Assistant"}),a.jsx("button",{onClick:()=>l(!1),children:a.jsx(u.Z,{className:"h-6 w-6"})})]}),a.jsx("div",{className:"flex-1",children:a.jsx(D,{userId:"demo.user@company.com"})})]})})]})}},96548:(e,t,s)=>{"use strict";s.d(t,{ER:()=>i,c3:()=>r,gw:()=>o,wN:()=>n});let a=s(11934).Z.create({baseURL:"https://qms-agent-728802725258.us-central1.run.app",timeout:1e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>e);class n{static async executeFunction(e){return(await a.post("/action/execute",e)).data}static async getFunctions(){return(await a.get("/action/functions")).data}static async validateFunction(e){return(await a.post("/action/validate",e)).data}static async batchExecute(e){return(await a.post("/action/batch",e)).data}}class r{static async create(e,t,s=!1){return n.executeFunction({function_name:"create_capa",arguments:e,user_id:t,confirmed:s})}static async updateAnalysis(e,t,s=!1){return n.executeFunction({function_name:"update_capa_analysis",arguments:e,user_id:t,confirmed:s})}static async addAction(e,t,s=!1){return n.executeFunction({function_name:"add_capa_action",arguments:e,user_id:t,confirmed:s})}static async addApproval(e,t,s=!1){return n.executeFunction({function_name:"add_capa_approval",arguments:e,user_id:t,confirmed:s})}static async updateStatus(e,t,s=!1){return n.executeFunction({function_name:"update_capa_status",arguments:e,user_id:t,confirmed:s})}static async getDetails(e,t){return n.executeFunction({function_name:"get_capa_status",arguments:{capa_id:e},user_id:t,confirmed:!1})}static async getById(e){return(await a.get(`/capa/${e}`)).data}}class i{static async create(e,t,s=!1){return n.executeFunction({function_name:"create_dcr",arguments:e,user_id:t,confirmed:s})}static async addDocuments(e,t,s=!1){return n.executeFunction({function_name:"add_dcr_documents",arguments:e,user_id:t,confirmed:s})}static async addApproval(e,t,s=!1){return n.executeFunction({function_name:"add_dcr_approval",arguments:e,user_id:t,confirmed:s})}static async updateStatus(e,t,s=!1){return n.executeFunction({function_name:"update_dcr_status",arguments:e,user_id:t,confirmed:s})}static async getDetails(e,t){return n.executeFunction({function_name:"get_dcr_status",arguments:{dcr_id:e},user_id:t,confirmed:!1})}static async getById(e){return(await a.get(`/dcr/${e}`)).data}}class o{static async getStats(){return{capas:{total:45,open:12,overdue:3,by_severity:{Minor:15,Major:25,Critical:5}},dcrs:{total:28,pending_approval:8,in_review:5,by_priority:{Low:10,Medium:15,High:3}},recent_activity:[{id:"1",type:"capa",action:"Created CAPA for sterilization issue",user:"jane.doe@company.com",timestamp:new Date().toISOString(),entity_id:"CAPA-20251209-ABC123"},{id:"2",type:"dcr",action:"Approved DCR for SOP-001 update",user:"john.smith@company.com",timestamp:new Date(Date.now()-36e5).toISOString(),entity_id:"DCR-20251209-XYZ789"}]}}}},11453:(e,t,s)=>{"use strict";s.d(t,{_$:()=>d,b2:()=>l,cn:()=>r,o0:()=>o,p6:()=>i,z2:()=>c});var a=s(56815),n=s(79377);function r(...e){return(0,n.m6)((0,a.W)(e))}function i(e){return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(new Date(e))}function o(e){return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e))}function c(e){return({Open:"status-open","In Progress":"status-in-progress","Awaiting Verification":"status-in-progress",Completed:"status-completed",Closed:"status-closed",Draft:"status-open","In Review":"status-in-progress",Approved:"status-completed",Rejected:"status-closed",Implemented:"status-completed",Pending:"status-open",Overdue:"bg-danger-50 text-danger-600"})[e]||"status-open"}function l(e){return({Minor:"bg-blue-50 text-blue-600",Major:"bg-warning-50 text-warning-600",Critical:"bg-danger-50 text-danger-600"})[e]||"bg-gray-50 text-gray-600"}function d(e){return({Low:"bg-gray-50 text-gray-600",Medium:"bg-warning-50 text-warning-600",High:"bg-danger-50 text-danger-600"})[e]||"bg-gray-50 text-gray-600"}},21342:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r,metadata:()=>n});var a=s(25036);s(5023);let n={title:"QMS Portal - ISO 13485 Compliance System",description:"Quality Management System portal for CAPA and DCR workflow management"};function r({children:e}){return a.jsx("html",{lang:"en",children:a.jsx("body",{children:e})})}},5023:()=>{}};